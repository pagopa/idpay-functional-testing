trigger:
  - main

pool:
  vmImage: 'ubuntu-latest'

variables:
  # Python version: 3.10
  pythonVersion: '3.10'

  # folder name of this sub-repository
  working-dir: '.'

  # Project root folder
  projectRoot: $(System.DefaultWorkingDirectory)/$(working-dir)

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: '$(pythonVersion)'
    displayName: 'Use Python $(pythonVersion)'

  - script: |
      python -m venv .venv
      source .venv/bin/activate
      python -m pip install --upgrade pip
      pip install setup
      pip install -r requirements.txt

    workingDirectory: $(projectRoot)
    displayName: "Install requirements"

  - script: |
      source .venv/bin/activate
      pytest --junitxml=tests/reports/junit.xml -vv
    workingDirectory: $(projectRoot)
    displayName: 'Run tests with Pytest'

  - task: PublishTestResults@2
    inputs:
      testResultsFormat: 'JUnit'
      testResultsFiles: 'tests/reports/junit.xml'
      testRunTitle: 'Pytest Results'
      failTaskOnFailedTests: true
